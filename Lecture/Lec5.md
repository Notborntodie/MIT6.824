#  Lecture 5: Raft (1)

[TOC]

## Single point of failure

 我们在容错系统中发现的一个模式：

- MR复制计算，但依赖单一主节点进行组织
- GFS复制数据，但依赖主节点选择主要节点
- VMware FT复制服务，但依赖test-and-set选择主节点

所有这些都依赖==单一实体==进行关键决策 

好处：单一实体的决策**避免了脑裂现象** 让单一实体始终与自身达成一致非常简单

我们现在需要降低downtime的时间和增加uptime的时间，所以需要raft协议

### 简单复制test-and-set server

回顾VMware FT中，比如C1和C2现在需要通过发起`test-and-set `的request,





我们需要复制如何选择两个服务器，S1和S2 如果两者都正常，S1负责，将决策转发给S2 如果S2发现S1宕机，S2接管成为唯一的测试和设置服务器 会出现什么问题？ 网络分区！脑裂！

问题：计算机无法区分"服务器崩溃"和"网络断裂" 症状相同：网络查询无响应 这个难题在很长一段时间内似乎无法解决 似乎需要外部代理（人类）来决定何时切换服务器 我们更希望有一个自动化的方案！

应对分区的重大启示：多数投票 拥有奇数个服务器，例如3个 需要多数人同意才能执行任何操作——2个中的3个 如果没有多数，就等待 为什么多数投票有助于避免脑裂？ 最多只有一个分区可以占多数 打破了之前仅有两个服务器的对称性 注意：多数投票是基于所有服务器，而不仅仅是活动的服务器 注意：在获得多数票后进行 不要等待更多，因为它们可能已经死了 更一般地说，2f+1可以容忍f个失败的服务器 因为剩下的f+1在2f+1中占多数 如果超过f个服务器失败（或无法联系），则无法继续进行 通常称为"法定人数"系统

多数的一个关键属性是任意两个多数都有交集 交集中的服务器可以传达关于先前决策的信息 例如，本轮已经选出了另一个Raft领导者

